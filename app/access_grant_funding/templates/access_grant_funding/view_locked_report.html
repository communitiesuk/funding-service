{% extends "access_grant_funding/base.html" %}
{% from "govuk_frontend_jinja/components/back-link/macro.html" import govukBackLink %}
{% from "common/macros/submissions.html" import answers_summary_list with context %}

{% set page_title = "Review report: " + submission.name %}

{% set active_item_identifier = "reports" %}
{% block beforeContent %}
  {{
    govukBackLink({
      "href": url_for("access_grant_funding.list_reports", organisation_id=grant_recipient.organisation.id, grant_id=grant_recipient.grant.id),
      "text": "Back"
    })
  }}
{% endblock beforeContent %}
{% block content %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <h1 class="govuk-heading-l">{{ page_title }}</h1>

      {% for form in submission.get_ordered_visible_forms() %}
        <h2 class="govuk-heading-m govuk-!-margin-top-4">{{ form.title }}</h2>
        {{ answers_summary_list(submission, form) }}
      {% endfor %}
    </div>
  </div>
  {% if authorisation_helper.is_access_grant_certifier(submission.grant.id, submission.submission.grant_recipient.organisation_id, current_user) %}
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">
        <h2 class="govuk-heading-m">Sign off and submit report</h2>
        <p class="govuk-body">Sign off and submit the report to the {{ submission.collection.grant.organisation.name }} by {{ format_date_short(submission.collection.submission_period_end_date) }}.</p>

        <p class="govuk-body">If you need to decline the report, provide a reason so {{ submission.sent_for_certification_by.name }} can update and resubmit the report.</p>

        <form method="POST" novalidate>
          <div class="govuk-button-group">
            {{ form.csrf_token }}
            {{ form.submit(params={"text": "Sign off and submit report" }) }}
            <a class="govuk-button--secondary govuk-button" href="{{ url_for("access_grant_funding.decline_report", organisation_id=grant_recipient.organisation_id, grant_id=grant_recipient.grant_id, submission_id=submission.id) }}">
              Decline sign off
            </a>
          </div>
        </form>
      </div>
    </div>
  {% endif %}
{% endblock %}
