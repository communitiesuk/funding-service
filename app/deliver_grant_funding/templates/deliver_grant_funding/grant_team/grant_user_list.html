{% extends "deliver_grant_funding/base.html" %}
{% from "govuk_frontend_jinja/components/table/macro.html" import govukTable %}
{% from "govuk_frontend_jinja/components/notification-banner/macro.html" import govukNotificationBanner %}
{% from "govuk_frontend_jinja/components/button/macro.html" import govukButton %}

{% block pageTitle %}
  Grant team - {{ grant.name }} - MHCLG Funding Service
{% endblock pageTitle %}

{% set active_item_identifier = "grant_team" %}

{% block content %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      {% with messages = get_flashed_messages() %}
        {% if messages %}
          {% set user_add_success_message %}
            <h3 class="govuk-notification-banner__heading">Grant team member added</h3>
            <p class="govuk-body">{{ messages[0] }}</p>
          {% endset %}
          {{
            govukNotificationBanner({
              "html": user_add_success_message, "type": "success"
            })
          }}
        {% endif %}
      {% endwith %}
      <h1 class="govuk-heading-l">
        <span class="govuk-caption-l">{{ grant.name }}</span>
        Grant team
      </h1>
      {% if current_user.is_platform_admin %}
        {{
          govukButton({
             "text": "Add grant team member",
             "href": url_for("deliver_grant_funding.add_user_to_grant", grant_id=grant.id)
          })
        }}
      {% endif %}
    </div>
  </div>

  {% set table_pending_signin_rows = namespace(items=[]) %}
  {% if users %}
    {% for user in users if not user.name %}
      {%
        set table_pending_signin_rows.items = table_pending_signin_rows.items + [[
          {"text": user.email},
          {"text": "Grant team member"}
        ]]
      %}
    {% endfor %}
  {% endif %}

  {% if table_pending_signin_rows.items|length > 0 %}
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-full">
        <h2 class="govuk-heading-m govuk-!-margin-bottom-1 govuk-!-margin-top-9">Not yet signed in</h2>
        <p class="govuk-body">Grant team members who have been added but not signed in yet.</p>
        {{
          govukTable({
              "captionClasses": "govuk-table__caption--m",
              "firstCellIsHeader": false,
              "head": [{"text": "Email"}, {"text": "Role", "classes": "govuk-!-width-one-quarter"}],
              "rows": table_pending_signin_rows.items
          })
        }}
      </div>
    </div>
  {% endif %}

  {% set table_rows = namespace(items=[]) %}

  {% if users %}
    {% for user in users if user.name %}
      {%
        set table_rows.items = table_rows.items + [[
          {"text": user.name},
          {"text": user.email},
          {"text": "Grant team member"}
        ]]
      %}
    {% endfor %}
  {% endif %}
  {% if table_rows.items|length > 0 %}
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-full">
        <h2 class="govuk-heading-m govuk-!-margin-bottom-1 govuk-!-margin-top-9">Grant team members</h2>
        {{
          govukTable({
              "captionClasses": "govuk-table__caption--m",
              "firstCellIsHeader": false,
              "head": [{"text": "Name"}, {"text": "Email"}, {"text": "Role", "classes": "govuk-!-width-one-quarter"}],
              "rows": table_rows.items
          })
        }}
      </div>
    </div>
  {% endif %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <h2 class="govuk-heading-m govuk-!-margin-top-5">If you need to add other grant team members</h2>
      <p class="govuk-body">
        Contact us through our
        <a class="govuk-link govuk-link--no-visited-state" href="{{ service_desk_url }}" target="_blank">support desk (opens in new tab)</a>
        .
      </p>
      <p class="govuk-body">Monday to Friday, 9am to 5pm (except public holidays).</p>
    </div>
  </div>
{% endblock content %}
