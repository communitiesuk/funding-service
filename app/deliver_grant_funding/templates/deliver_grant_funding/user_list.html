{% from "govuk_frontend_jinja/components/summary-list/macro.html" import govukSummaryList %}
{% extends "deliver_grant_funding/manage_grant_base.html" %}
{% from "govuk_frontend_jinja/components/table/macro.html" import govukTable %}
{% from "govuk_frontend_jinja/components/notification-banner/macro.html" import govukNotificationBanner %}
{% from "govuk_frontend_jinja/components/button/macro.html" import govukButton %}

{% block pageTitle %}
  User - {{ grant.name }} - MHCLG Funding Service
{% endblock pageTitle %}

{% set active_item_identifier = "grant_team" %}

{% block content %}
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="govuk-grid-row">
        {% set user_add_success_message %}
          <h3 class="govuk-notification-banner__heading">Grant team member added</h3>
          <p class="govuk-body">{{ messages[0] }}</p>
        {% endset %}
        {{
          govukNotificationBanner({
            "html": user_add_success_message, "type": "success"
          })
        }}
      </div>
    {% endif %}
  {% endwith %}

  <div class="govuk-grid-row">
    <h1 class="govuk-heading-xl">
      <span class="govuk-caption-xl">{{ grant.name }}</span>
      Grant team
    </h1>
  </div>
  {% if current_user.is_platform_admin %}
    <div class="govuk-grid-row">
      {{
        govukButton({
           "text": "Add grant team member",
           "href": url_for("deliver_grant_funding.share_grant_with_user", grant_id=grant.id)
        })
      }}
    </div>
  {% endif %}
  <div class="govuk-grid-row govuk-!-margin-bottom-9">
    <h2 class="govuk-heading-m govuk-!-margin-bottom-1 govuk-!-margin-top-9">Not yet signed in</h2>
    <p class="govuk-body">Grant team members who have been added but not signed in yet.</p>
    {% set table_rows = namespace(items=[]) %}
    {% if users %}
      {% for user in users if user.name|lower == '' %}
        {%
          set table_rows.items = table_rows.items + [[
            {"text": user.email},
            {"text": "Grant team member"}
          ]]
        %}
      {% endfor %}
    {% endif %}

    {% if table_rows.items|length > 0 %}
      {{
        govukTable({
            "captionClasses": "govuk-table__caption--m",
            "firstCellIsHeader": false,
            "head": [{"text": "Email"}, {"text": "Role"}],
            "rows": table_rows.items
        })
      }}
    {% else %}
      <p class="govuk-body">No pending signin members.</p>
    {% endif %}
  </div>
  <div class="govuk-grid-row">
    {% set table_rows = namespace(items=[]) %}

    {% if users %}
      {% for user in users if user.name|lower != '' %}
        {%
          set table_rows.items = table_rows.items + [[
            {"text": user.name},
            {"text": user.email},
            {"text": "Grant team member"}
          ]]
        %}
      {% endfor %}
    {% endif %}

    {% if table_rows.items|length > 0 %}
      {{
        govukTable({
            "captionClasses": "govuk-table__caption--m",
            "firstCellIsHeader": false,
            "head": [{"text": "Name"}, {"text": "Email"}, {"text": "Role"}],
            "rows": table_rows.items
        })
      }}
    {% else %}
      <p class="govuk-body">Grant is not shared with a team.</p>
    {% endif %}
  </div>
{% endblock content %}
